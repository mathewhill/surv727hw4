---
title: "SURV 727 Assignment 4"
author: "Mathew Hill"
date: "2024-10-31"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#| include: false 
library(tidyverse)
library(DBI)
library(dbplyr)
library(bigrquery)
```

After you have initialized a project, paste your project ID into the following chunk.
```{r}
project <- "surv-727-project-4"
```

We will connect to a public database, the Chicago crime database, which has data on crime in Chicago.
```{r}
con <- dbConnect(
  bigrquery::bigquery(),
  project = "bigquery-public-data",
  dataset = "chicago_crime",
  billing = project
)
con
```

```{r}
dbListTables(con)
```


Write a first query that counts the number of rows of the ‘crime‘ table in the year 2016. Use code chunks with {sql connection = con} in order to write SQL code within the document
```{sql connection = con}
SELECT count(primary_type), count(*)
FROM crime
WHERE year = 2016
LIMIT 10
```

Next, count the number of arrests grouped by primary_type in 2016. Note that is a somewhat similar task as above, with some adjustments on which rows should be considered. Sort the results, i.e. list the number of arrests in a descending order.
```{sql connection = con}
SELECT primary_type, COUNT(*) AS arrest_count
FROM crime
WHERE year = 2016 AND arrest = TRUE
GROUP BY primary_type
ORDER BY arrest_count DESC
```

We can also use the date for grouping. Count the number of arrests grouped by hour of the day in 2016. You can extract the latter information from date via EXTRACT(HOUR FROM date). Which time of the day is associated with the most arrests?
```{sql connection = con}
SELECT EXTRACT(HOUR FROM date) AS arrest_hour, COUNT(*) AS arrest_count
FROM crime
WHERE year = 2016 AND arrest = TRUE
GROUP BY arrest_hour
ORDER BY arrest_count DESC;
```
Hour 19 appears to be associated with the most arrests.

Focus only on HOMICIDE and count the number of arrests for this incident type, grouped by
year. List the results in descending order.
```{sql connection = con}
SELECT year, COUNT(*) AS homicide_arrests
FROM crime
WHERE primary_type = 'HOMICIDE' AND arrest = TRUE
GROUP BY year
ORDER BY homicide_arrests DESC;
```

Find out which districts have the highest numbers of arrests in 2015 and 2016. That is, count
the number of arrests in 2015 and 2016, grouped by year and district. List the results in
descending order.
```{sql connection = con}
SELECT year, district, COUNT(*) AS arrest_count
FROM crime
WHERE year IN (2015, 2016) AND arrest = TRUE
GROUP BY year, district
ORDER BY arrest_count DESC;
```







